{% extends 'learnpathology/base.html' %}
{% load static %}

{% block content %}
    <script>setBackground(#a2ba8e)</script>




    <div class="card transparentBackground centerCardHorizontally border-0"
         style="width: 98%; height: 98%;">
        <div class="row no-gutters w-100 h-100">

            <div class="col" style="height: fit-content;">

                <!-- INFO CARD -->
                <div class="card slideInfoCard border-0">
                    <div class="row align-items-center" style="padding-top: 3%; padding-bottom: 3%;">
                        <div class="col" style="margin-left: auto;">
                            <div class="card-title" style="padding-left: 10%;">
                                <h4>{{ slide.name }}</h4>
                            </div>
                        </div>
                    </div>
                    <!-- CARD CONTENT -->

                    <!-- Accordion CONTENT -->

                    <div class="accordion" id="accordionExample">
                        <div class="accordion-item">
                            <h3 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseOne" aria-expanded="true"
                                        aria-controls="collapseOne" >
                                    Core Information
                                </button>
                            </h3>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                                 data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <table class="table">

                                        <tr>
                                            <th>Slide name</th>
                                            <td>{{ slide.name }}</td>
                                        </tr>
                                        <tr>
                                            <th>Slide description</th>
                                            <td>{{ slide.description }}</td>
                                        </tr>


                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Categorization
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                                 data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <table class="table">
                                        <tr>
                                            <th>Organ</th>
                                            <td>{{ slide.name }}</td>
                                        </tr>
                                        <tr>
                                            <th>Histology/pathology</th>
                                            {% if slide.pathology %}
                                                <td>Pathology</td>
                                            {% else %}
                                                <td>Histology</td>
                                            {% endif %}
                                        </tr>
                                        <tr>
                                            <th>Stain</th>
                                            <td>{{ stain_name }}</td>
                                        </tr>


                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseThree" aria-expanded="false"
                                        aria-controls="collapseThree">
                                    Supplementary information
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree"
                                 data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <table class="table">

                                        <tr>
                                            <th>
                                                Long description
                                                {% if request.user.is_teacher or request.user.is_superuser %}
                                                    <div class="card-content" style="padding-top: 5px">
                                                        <a class="LPButton"
                                                           href="{% url 'slide:edit_description' slide.id %}"
                                                           style="margin: 0;">
                                                            Edit long description
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </th>
                                            {% if slide.long_description %}
                                                <td>{{ slide.long_description }}</td>
                                            {% else %}
                                                <td>-</td>
                                            {% endif %}
                                        </tr>
                                        <tr>
                                            <th>
                                                General pathology tags
                                                {% if request.user.is_teacher or request.user.is_superuser %}
                                                    <div class="card-content" style="padding-top: 5px">
                                                        <a class="LPButton" href="{% url 'slide:edit_tags' slide.id %}"
                                                           style="margin: 0;">
                                                            Edit tags
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </th>
                                            <td>
                                                {% if general_pathology_tags %}
                                                    {% for tag in general_pathology_tags %}
                                                        {{ tag.name }}<br>
                                                    {% endfor %}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseFour" aria-expanded="false"
                                        aria-controls="collapseFour">
                                    Annotations
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour"
                                 data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    Show here available annotations
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion CONTENT END -->


                </div>

            </div>

            <!-- WSI VIEWER -->
            <div class="col col-12 col-lg-9 slideViewerCol">
                <div class="card slideViewerCard transparentBackground">
                    <div id="wsi-canvas" class="wsi_canvas" style="height: 100%;"></div>
                </div>
            </div>
        </div>

    </div>


    <script src="{% static 'slide/openseadragon.min.js' %}"></script>
    <script type="text/javascript">
        var viewer = OpenSeadragon({
            id: "wsi-canvas",
            zoomPerScroll: 2, // Scroll speed
            showNavigator: true, // The navigation window top-right
            prefixUrl: "{% static 'slide/images/' %}", // Where to find OpenSedragon button images
            tileSources: {
                width: {{ slide.width }},
                height:  {{ slide.height }},
                tileWidth: {{ slide.tile_width }},
                tileHeight: {{ slide.tile_height }},
                minLevel: 0,
                maxLevel: {{ slide.osd_levels }}-1,
                getTileUrl: function (level, x, y) {
                    return "/viewer/tile/{{ slide.id }}/" + ({{ slide.osd_levels }} -1 - level) + "/" + x + "/" + y + "/";
                },
            }
        });
    </script>
    <script>
        function toggleInfoCardVisibility() {
            var x = document.getElementById("slideInfoCardContent");
            console.log("clicked button to toggle card visibility");
            console.log(x);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }
    </script>
{% endblock %}