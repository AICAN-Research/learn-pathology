{% extends 'learnpathology/base.html' %}
{% load slide_filters %}
{% load bootstrap_icons %}


<script>

$(document).ready(function(){
  activateTab('aaa');
});

function activateTab(tab){
  $('.nav-tabs a[href="#' + tab + '"]').tab('show');
}

$(document).ready(function() {
    $('.btn').onclick(function (event) {
        this.form.submit();
    });
});

</script>


{# ================================================ #}
{#              BEGIN CONTENT                       #}
{# ================================================ #}
{% block content %}

<div class="container">
    <h1>Image browser</h1>
</div>
<div class="card mx-auto text-center" style="width: 90%">
<div class="card-body">
<div class="card-text">

    {% if user.is_superuser or user.is_teacher %}
    <p>
        <a href="{% url 'slide:add' %}">Add a whole slide image to the database</a>
    </p>
    {% endif %}


    <form class="form" id="imageCategoryForm" onsubmit="{% url 'slide:browser' %}">

        <!-- ORGAN SYSTEM selection -->
        <div class="row no-gutters">
            <div class="col-sm-5 col-md-3">
                <div class="card h-100" style="margin-top: auto; margin-bottom: auto">
                    <div class="card-body">
                        <h5 class="card-title">Organ system:</h5>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card text-left">
                    <div class="card-body container-fluid">
                        <!-- Show 'All' button -->
                        {% if selected_organ_tags %}
                            <button type="submit" class="btn btn-light border-primary" name="organ_system"
                                    value="All" id="all-organs">All</button>
                        {% else %}
                            <button type="submit" class="btn btn-light border-primary active"  name="organ_system"
                                    value="All" id="all-organs">All</button>
                        {% endif %}

                        <!-- Other organ buttons -->
                        {% for organ in organ_tags %}
                            {% if organ in selected_organ_tags %}
                                <button type="submit" class="btn btn-light border-primary active"  name="organ_system"
                                        value="{{ organ.id }}" id="{{ organ.id }}" >{{ organ.name }}</button>
                            {% else %}
                                <button type="submit" class="btn btn-light border-primary" name="organ_system"
                                    value="{{ organ.id }}" id="{{ organ.id }}">{{ organ.name }}</button>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- HISTOLOGY/PATHOLOGY selection -->
        <div class="row no-gutters">
            <div class="col-sm-5 col-md-3">
                <div class="card h-100" style="margin-top: auto; margin-bottom: auto">
                    <div class="card-body">
                        <h5 class="card-title">Histology or pathology?</h5>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card text-left">
                    <div class="card-body container-fluid">

                        {% if selected_histology and selected_pathology %}
                            <button type="submit" class="btn btn-light border-primary active" name="histology_pathology" value="both">Both</button>
                        {% else %}
                            <button type="submit" class="btn btn-light border-primary" name="histology_pathology" value="both">Both</button>
                        {% endif %}

                        {% if selected_histology and not selected_pathology %}
                            <button type="submit" class="btn btn-light border-primary active"  name="histology_pathology" value="histology">Histology</button>
                        {% else %}
                            <button type="submit" class="btn btn-light border-primary" name="histology_pathology" value="histology">Histology</button>
                        {% endif %}

                        {% if selected_pathology and not selected_histology %}
                            <button type="submit" class="btn btn-light border-primary active" name="histology_pathology" value="pathology">Pathology</button>
                        {% else %}
                            <button type="submit" class="btn btn-light border-primary" name="histology_pathology" value="pathology">Pathology</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

    </form>

    {% comment %}
    {% if search_query %}

        {% if search_result %}
            <h4>Search results</h4>
            <table class="table">
            <thead class="thead-light">
                <tr>
                    <th>Thumbnail</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Tasks</th>
                    {% if request.user.is_teacher or request.user.is_superuser %}
                    <th>Create task</th>
                    {% endif %}
                </tr>
            </thead>
            {% for slide in search_result %}
                <tr>
                    <td><a href="{% url 'slide:view_full' slide.id %}"><img src="/slide/thumbnails/{{ slide.id }}.jpg" style="width: 100px"></a></td>
                    <td>{{ slide.name }}</td>
                    <td>{{ slide.description }}</td>
                    <td><a href="">Tasks</a></td>
                    {% if request.user.is_teacher or request.user.is_superuser %}
                    <td><a href="{% url 'multiple_choice:new' slide.id %}">Create new task</a></td>
                    {% endif %}
                </tr>
            {% endfor %}
            </table>
        {% else %}
            <p>
                No slides found with search.
            </p>
        {% endif %}

    {% else %}
    {% endcomment %}

    {% if slides %}

        <div class="row">
            <div class="col">
                <div class="card no-card-border">
                    <div class="card-body align-content" style="margin-left: auto; padding-top: 10px; padding-bottom: 10px">

                        <a href="{% url 'slide:grid_view' %}" class="btn border-primary">{% bs_icon 'grid' %}Grid</a>
                        <a href="{% url 'slide:list_view' %}" class="btn border-primary">{% bs_icon 'list' %}List</a>

                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="min-height: 600px; padding-top: 10px">
            {% block image_viewer %}
            {% endblock %}

            {% comment %}
            {% if view_type == 'grid' %}
                {% include 'slide/grid_view.html' with slides=slides %}
            {% elif view_type == 'list' %}
                {% include 'slide/list_view.html' with slides=slides %}
            {% else %}
                Select a view using the 'Grid' and 'List' buttons.
            {% endif %}
            {% endcomment %}
        </div>

    {% else %}
        No slides available.
    {% endif %}

</div>
</div>
</div>
{% endblock content %}
