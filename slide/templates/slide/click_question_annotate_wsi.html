{% load static %}
{% load slide_filters %}

<div class="container fill" style="min-height: 600px">

<div id="wsi-canvas" class="wsi_canvas" style="height: 600px;"></div>
<div id="my-toolbar-container"></div>
</div>

<script src="{% static 'slide/openseadragon.min.js' %}"></script>
<script src="{% static 'slide/annotorious-openseadragon-2.7.16/openseadragon-annotorious.min.js' %}"></script>
<!-- TODO: Set fixed version for Annotorious-related plugins! -->
<script src="https://cdn.jsdelivr.net/npm/@recogito/annotorious-toolbar@latest/dist/annotorious-toolbar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@recogito/annotorious-selector-pack@latest/dist/annotorious-selector-pack.min.js"></script>
    <script src="{% static 'slide/annotorious.min.js' %}"></script>

<script type="text/javascript">
    var viewer = OpenSeadragon({
    id: "wsi-canvas",
    zoomPerScroll: 2, // Scroll speed
    minScrollDeltaTime: 150, //	Number of milliseconds between canvas-scroll events.
    zoomPerClick: 1, // disable click to zoom
    showNavigator: true, // The navigation window top-right
                 showHomeControl: false,     // Hide the home button
        showZoomControl: false,     // Hide the zoom-in and zoom-out buttons
    prefixUrl: "{% static 'slide/images/' %}", // Where to find OpenSedragon button images
    tileSources:   {
        width: {{ slide.width }},
        height:  {{ slide.height }},
        tileWidth: {{ slide.tile_width }},
        tileHeight: {{ slide.tile_height }},
        minLevel: 0,
        maxLevel: {{ slide.osd_levels }}-1,
        getTileUrl: function( level, x, y ) {
            return "/viewer/tile/{{ slide.id }}/" + ({{ slide.osd_levels }} - 1 - level) + "/" + x + "/" + y + "/";
        },
        overlays: [
            ],
    }
    });
    viewer.innerTracker.keyHandler = null;

        var anno = OpenSeadragon.Annotorious(viewer);
    Annotorious.SelectorPack(anno); // [ 'rect', 'polygon', 'point', 'circle', 'ellipse', 'freehand' ]
    anno.removeDrawingTool('point');


    const toolbar = new Annotorious.Toolbar(anno, document.getElementById('my-toolbar-container'));
    viewer.addControl(document.getElementById("my-toolbar-container"), {anchor: OpenSeadragon.ControlAnchor.TOP_LEFT});

    document.getElementById('my-toolbar-container').addEventListener('click', function(event) {
    event.preventDefault();
});


    {% for box in boxes %}
        addBoundingBoxNoTextInput(
            {{box.position_x}}, {{ box.position_y }},
            {{box.position_x}} + {{box.width}}, {{box.position_y}} + {{ box.height }}
        );
    {% endfor %}


</script>